## 数组类型
PostgreSQL支持表的字段使用定长或可变长度的一维或多维数组，数组的类型可以是任何数据库内建的类型、用户自定义的类型、枚举类型，以及组合类型。

### 数组类型的声明
一个数组类型的定义就是通过在数组元素类型名后面附加方括号（［］）来实现的。方括号中可以给一个长度数字,也可不给。也可以定义多维数组，多维数组就是加多对方括号实现的。实际上，在目前的PostgreSQL中，如果在定义数组类型中填一个数组长度的数字，这个數字是没有什么用处的，不会限制数组的长度；定义时指定数组维度也是没有意义的，数组的维度是根据实际插入的数据来确定的。

```SQL
create table testtab05(id int, coll int[]);
insert into testtab05 values(1,'{1,2,3}');
```

逗号分隔各个元素值与元素类型有关
```sql
select typname, typdelim
  from pg_type
 where typname in ('int4', 'int8', 'bool', 'char')
```

### 插入数据
1. 那么字符串中有逗号时,可以使用双引号
2. 如果字符串中有单引号,可以使用两个连接的单引号表示一个单引号
3. 如果输入的字符串中有括号"{"和"}"怎么办呢？只需把它们放到双引号中即可
4. 如果输入的字符串中有双引号，需要在双引号前加反斜扛

要将一个数组元素的值设为NULL,直接写上NULL即可（大小写无关）。要将一个数组元素的值设为字符串"NULL",那么就必须加上双引号。

除了上面介绍的方法以外，还可以使用ARRAY构造器语法输入数据，一个数组构造器是一个表达式，它从自身的成员元素上构造一个数组值。一个简单的数组构造器由关键字ARRAY. 一个左方括号([)、一个或多个表示数组元素值的表达式（用逗号分隔）、一个右方括孤(])组成。见下面的示例：

在向多维数组中插入值时，各个维度的元素个数必须相同
```sql
insert into testtab07 values (2, '{{a,b,nul1},{c,d,e}}');
```

默认情况下，PostgreSQL数据库中数组的下标是从1开始的，但也可以指定下标的开始值
```sql
'［下标：上标］=［元素值1,元素值2,元素值3..］'
```
**上标、下标都包含**

### 访问数据
访问数组中的元素时，在方括号内加数字就可以了
```sql
select col[index_num] from table_name;
select col[start_index_num:stop_index_num] from table_name;
```

在对二维数组进行访问时，如果只使用一个下标是**不能**返回其中一维的全部元素。实际上，如果想返回多维数组中某一维的全部元素，可以使用切片，切片的起始位置与结束位置相同即可
```sql
col[index_num:index_num]
```


单个下标和切片混用时，只要出现一个冒号，其他的单个下标将表示从1开始的一个切片，下标的数据表示切片的结束值
```sql
col[dim_index][start_index_num:stop_index_num] = col[1: dim_index][start_index_num:stop_index_num]
```

### 修改数组
数组值可以被整个替换，也可只替换数组中的单个元素。可以按照访问的方式去修改数据。

**注意，不能直接修改多维数组中某一维的值**

### 数组的操作符
- 基本操作

| 操作符       | 描述                                                         |
| ------------ | ------------------------------------------------------------ |
| =            | 比较是否相等，两个数组的维度及每个维度的元素个数和值以及顺序必须完全相等才返回真，否则返回假 |
| <、>、<=、>= | 小于、大于、小于等于、大于等于这四个比较符是按Btree比较函数对元素逐个进行比较的 |

- 集合操作

| 操作符 | 描述                 |
| ------ | -------------------- |
| @>     | 包含                 |
| <@     | 被包含于             |
| &&     | 重叠，是否有共同元素 |

不同维度之间的数组也可以进行“包含”、“重叠”等集合比较操作,这些操作与元素的顺序及维度基本都没有关系。实际上可以认为，在做集合比较时，不管数组中的元素在哪一维，都可以把它们都当成集合中的一个元素，而与数组的维度没有关系。

**`||`连接符只能操作，标量和一维，一维和二维，不能操作跨维度数据**

### 数组的函数
| 函数                               | 描述                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| array_append(anyarray,anyelement)  | 向数组末尾添加元素，返回新数组                               |
| array_cat(anyarray, anyarray)      | 返回新数组                                                   |
| array_ndims(anyarray)              | 返回数组的维度，返回值类型为int                              |
| array_dims(anyarray)               | 返回数据维度结构的文本表示方式                               |
| array_fill(anyelement,anyarray）   | 创建出一个数组（可以是多维），数组的元素值由第一个参数指定；数组的维度由第二个参数的个数指定；而数组每个维度元素的个数由第二个参数数组中的各个值指定；数组第一个元素的起始位置由第三个参数指定 |
| array_length(anyarray,int)         | 返回数组指定维度的长度，维度数是由第二个参数指定的           |
| array_lower(anyarray,int)          | 返回数组的下标                                               |
| array_upper(anyarray,int)          | 返回数组的上标                                               |
| array_prepend(anyelement,anyarray) | 在数组的开头插入一个元素                                     |
| array_remove(anyarray,anyelement)  | 移除数组中的值为指定值的元素，只支持一维数组                 |
| array_replace(anyarray,anyelement) | 把数组中等于指定值元素的值用另一个指定值替代                 |
| array_to_string(anyarray,text)     | 使用指定的分隔符（第二个参数）将数组元素连接为字符串         |
| string_to_array(text,text)         | 把用指定的分隔符分隔的字符串转成数组                         |
| unnest(anyarray)                   | 把数组变成多行返回                                           |

**数组还有一个聚合函数array_agg，普通元素聚合成数组**
